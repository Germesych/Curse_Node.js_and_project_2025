### 2. **Добавление друзей и подписка на других пользователей**

Этот функционал является важной частью социальной платформы, так как он позволяет пользователям взаимодействовать друг с другом. Студенты должны научиться реализовывать системы добавления друзей и подписки на пользователей, что будет включать отправку запросов, принятие и отклонение их, а также возможность просматривать список друзей и подписок.

#### 2.1. **Добавление друзей**

- **Требования:**
  - Пользователь должен иметь возможность отправить запрос на добавление в друзья другому пользователю.
  - Запрос должен быть подтвержден или отклонен получателем.
  - Пользователи, которые стали друзьями, должны появляться в списке друзей одного и другого.
  - Должна быть возможность удалить друга из списка.

- **Шаги реализации:**
  1. **Создание модели "Друзья"**:
     - Для связи пользователей создадим модель "Friendship", которая будет содержать:
       - `user1` (ID первого пользователя),
       - `user2` (ID второго пользователя),
       - `status` (статус запроса: ожидает подтверждения, подтверждено, отклонено).
     - Каждое дружеское отношение будет храниться как отдельный объект в базе данных.
  2. **Создание маршрута для отправки запроса**:
     - Пользователь должен иметь возможность отправить запрос на добавление в друзья другому пользователю.
     - При отправке запроса в базу данных записывается новый объект с `status: 'pending'`.
  3. **Маршрут для принятия или отклонения запроса**:
     - Получатель запроса может подтвердить или отклонить его.
     - Если запрос принят, в базе данных статус изменяется на `accepted`.
     - Если отклонен — статус на `rejected`.
  4. **Просмотр списка друзей**:
     - Каждый пользователь должен иметь возможность видеть список своих друзей.
     - Список формируется по наличию записей в таблице "Friendship", где статус = 'accepted'.
  5. **Удаление друга**:
     - Реализовать возможность удаления пользователя из списка друзей. Это можно сделать, удалив запись из таблицы "Friendship".

#### 2.2. **Подписка на других пользователей**

- **Требования:**
  - Пользователь должен иметь возможность подписываться на других пользователей, чтобы получать обновления о их действиях (например, новые посты или действия).
  - У подписки может быть статус (например, активная, отмененная).
  - Пользователь должен иметь возможность отменить подписку на других пользователей.
  
- **Шаги реализации:**
  1. **Создание модели "Подписка"**:
     - Модель будет хранить информацию о подписке, например:
       - `follower` (ID пользователя, который подписывается),
       - `following` (ID пользователя, на которого подписываются),
       - `status` (статус подписки: активная, отмененная).
  2. **Маршрут для отправки подписки**:
     - Пользователь должен иметь возможность подписаться на другого пользователя.
     - В базе данных добавляется новая запись с типом подписки.
  3. **Маршрут для отмены подписки**:
     - Пользователь может отменить свою подписку на другого пользователя, удалив запись из базы данных.
  4. **Просмотр подписок и подписчиков**:
     - Каждый пользователь должен иметь возможность просматривать, кто на него подписан, и на кого он подписан.
     - Просмотр подписок можно реализовать через запросы, которые будут искать записи в таблице подписок с соответствующими значениями `follower` или `following`.

#### 2.3. **Реализация уведомлений для подписок и запросов на добавление в друзья**

- **Требования:**
  - Уведомления должны отправляться пользователю при:
    - Получении запроса на добавление в друзья.
    - Принятии или отклонении запроса.
    - Получении подписки.
  - Уведомления должны быть отображены на платформе или отправлены пользователю (например, по email или через сообщения в приложении).

- **Шаги реализации:**
  1. **Уведомления о запросах на дружбу**:
     - Создать систему уведомлений, которая будет оповещать пользователя о новом запросе на добавление в друзья.
     - Уведомление может быть реализовано как запись в базе данных с текстом уведомления и флагом о том, что оно было прочитано.
  2. **Уведомления о подписке**:
     - Когда пользователь подписывается на другого, отправляется уведомление подписанному пользователю.
     - Уведомление будет содержать имя подписавшегося пользователя и ссылку на его профиль.
  3. **Отображение уведомлений на интерфейсе**:
     - Уведомления должны быть видны пользователю на главной странице или в отдельном разделе (например, "Уведомления").
     - Уведомления должны отображать статус: прочитано/непрочитано.

#### 2.4. **Защита и безопасность**

- **Требования:**
  - Необходимо обеспечить безопасность взаимодействий:
    - Пользователь не должен иметь возможность отправить запрос другу, если это он сам.
    - Запрос на добавление в друзья должен быть отправлен через авторизованный запрос (с использованием JWT).
    - Защита от повторных запросов (например, не отправлять запросы на добавление в друзья, если они уже были отправлены).
  
- **Шаги реализации:**
  1. Проверка на "самоподписку" — нельзя подписаться на себя.
  2. Проверка на существование запроса — если запрос уже существует, не создавать новый.
  3. Реализовать проверку на авторизацию перед отправкой запроса на добавление в друзья или подписку.

#### 2.5. **Дополнительные особенности**

- **Ограничение на количество запросов**:
  - Ввести ограничение на количество запросов на добавление в друзья или подписок, которые могут быть отправлены пользователем за определенный период (например, 100 запросов в день).
  
- **История взаимодействий**:
  - Для каждого пользователя можно хранить историю взаимодействий, такую как добавление друзей, подписки и отмены.

---

### Ожидаемый результат:
- Реализован функционал добавления друзей с возможностью отправки запросов, принятия/отклонения и удаления друзей.
- Реализована система подписки на других пользователей с возможностью подписываться, отменять подписки и просматривать подписчиков.
- Уведомления о запросах на добавление в друзья и подписках.
- Все взаимодействия должны быть защищены, с правильной валидацией и авторизацией.

---

### Технические ресурсы:
- **Технологии**: Node.js, Express, MongoDB (или другие БД), JWT.
- **Библиотеки**: nodemailer (для отправки уведомлений), express-rate-limit (для ограничения запросов).
- **Важные концепции**: хеширование паролей, работа с моделями данных для "Друзей" и "Подписок", JWT для авторизации.

Этот этап проекта позволит студентам научиться работать с более сложными отношениями между пользователями, такими как добавление друзей и подписка, что является основой для реализации социальной сети или любой другой платформы с элементами взаимодействия между пользователями.