# **Middleware –≤ Express.js ‚Äî –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**  

## **1. –ß—Ç–æ —Ç–∞–∫–æ–µ Middleware?**  
üîπ Middl---

## **–ß—Ç–æ –¥–∞–ª—å—à–µ?**  
–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **—Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (MongoDB, Mongoose)!**  

–ö–∞–∫ —Ç–µ–±–µ –º–∞—Ç–µ—Ä–∏–∞–ª? –ù—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø–æ—è—Å–Ω–∏—Ç—å? üòä–º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å (`req`) –∏ –æ—Ç–≤–µ—Ç (`res`)** –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–ª—å—à–µ.  
üîπ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è **–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ä–∞–±–æ—Ç—ã —Å JSON –∏ —Ç.–¥.**  

üìå **–û–±—â–∏–π –≤–∏–¥ Middleware:**  
```js
app.use((req, res, next) => {
    console.log('Middleware —Å—Ä–∞–±–æ—Ç–∞–ª');
    next(); // –ü–µ—Ä–µ–¥–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–ª—å—à–µ
});---

## **–ß—Ç–æ –¥–∞–ª—å—à–µ?**  
–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **—Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (MongoDB, Mongoose)!**  

–ö–∞–∫ —Ç–µ–±–µ –º–∞—Ç–µ—Ä–∏–∞–ª? –ù—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø–æ—è—Å–Ω–∏—Ç—å? üòä` **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º**, –∏–Ω–∞—á–µ –∑–∞–ø—Ä–æ—Å "–∑–∞–≤–∏—Å–Ω–µ—Ç"!  

---

## **2. –í–∏–¥—ã Middleware**  
1Ô∏è‚É£ **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ** (—Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤).  
2Ô∏è‚É£ **–õ–æ–∫–∞–ª—å–Ω—ã–µ** (—Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞).  
3Ô∏è‚É£ **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ** (`express.json()`, `express.static()`).  
4Ô∏è‚É£ **–û—à–∏–±–∫–∏** (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏).  

---

## **3. –ì–ª–æ–±–∞–ª—å–Ω—ã–π Middleware**  
üìå Middleware —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å**.  
```js
app.use((req, res, next) => {
    console.log(`[${new Date().toISOString()}] ${req.method} ${req.url}`);
    next(); // –ü–µ—Ä–µ–¥–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–ª—å—à–µ
});
```
üìå –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç **–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏**.  

---

## **4. Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ (–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)**  
üìå –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö `Authorization`:  
```js
app.use((req, res, next) => {
    const token = req.headers.authorization;
    if (!token) {
        return res.status(403).json({ error: '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞' });
    }
    console.log('–¢–æ–∫–µ–Ω:', token);
    next();
});
```
üìå –ó–∞–ø—Ä–æ—Å –±---

## **–ß—Ç–æ –¥–∞–ª—å—à–µ?**  
–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **—Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (MongoDB, Mongoose)!**  

–ö–∞–∫ —Ç–µ–±–µ –º–∞—Ç–µ—Ä–∏–∞–ª? –ù—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø–æ—è—Å–Ω–∏—Ç—å? üòä= { id: 1, name: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä' }; // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    next();
});

app.get('/profile', (req, res) => {
    res.json(req.user);
});
```
üìå –û—Ç–∫—Ä—ã–≤–∞–µ–º `http://localhost:3000/profile` ‚Äî –ø–æ–ª—É—á–∞–µ–º `{ id: 1, name: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä' }`.  

---

## **6. –õ–æ–∫–∞–ª—å–Ω—ã–π Middleware (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞)**  
üìå Middleware –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫ **–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –º–∞—Ä—à—Ä—É—Ç—É**.  
```js
const checkAdmin = (req, res, next) => {
    if (req.query.admin !== 'true') {
        return res.status(403).json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω' });
    }
    next();
};

app.get('/admin', checkAdmin, (req, res) => {
    res.send('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å!');
});
```
üìå –û—Ç–∫—Ä—ã–≤–∞–µ–º `http://localhost:3000/admin?admin=true` ‚Üí –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω.  
üìå –ë–µ–∑ `?admin=true` –ø–æ–ª—É—á–∏–º `403: –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω`.  

---

## **7. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ Middleware –≤ Express**  
üìå **–†–∞–±–æ—Ç–∞ —Å JSON (–Ω—É–∂–Ω–æ –¥–ª—è `POST`-–∑–∞–ø—Ä–æ—Å–æ–≤)**  
```js
app.use(express.json()); // –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å JSON –≤ `req.body`
```
üìå **–ö–æ–¥–∏—Ä–æ–≤–∫–∞---

## **–ß—Ç–æ –¥–∞–ª—å—à–µ?**  
–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **—Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (MongoDB, Mongoose)!**  

–ö–∞–∫ —Ç–µ–±–µ –º–∞—Ç–µ—Ä–∏–∞–ª? –ù—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø–æ—è—Å–Ω–∏—Ç—å? üòä.urlencoded({ extended: true }));
```
üìå **–û—Ç–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤**  
```js
app.use(express.static('public')); // –¢–µ–ø–µ—Ä—å —Ñ–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```

---

## **8. Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**  
üìå –û—à–∏–±–∫–∏ –º–æ–∂–Ω–æ **–ª–æ–≤–∏—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å** –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º Middleware.  
```js
app.use((err, req, res, next) => {
    console.error('–û—à–∏–±–∫–∞:', err.message);
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' });
});
```
üìå –ï—Å–ª–∏ –≤ –∫–æ–¥–µ –±—É–¥–µ—Ç `next(new Error('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫'))`, —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç `500: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞`.  

---

## **9. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Middleware**  
üìå –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ Middleware –ø–æ–¥—Ä—è–¥:  
```js
const firstMiddleware = (req, res, next) => {
    console.log('–ü–µ—Ä–≤—ã–π Middleware');
    next();
};

const secondMiddleware = (req, res, next) => {
    console.log('–í—Ç–æ—Ä–æ–π Middleware');
    next();
};

app.get('/test', firstMiddleware, secondMiddleware, (req, res) => {
    res.send('–ì–æ—Ç–æ–≤–æ!');
});
```
üìå –í –∫–æ–Ω—Å–æ–ª–∏:  
```
–ü–µ—Ä–≤—ã–π Middleware
–í—Ç–æ—Ä–æ–π Middleware
```
üìå –í –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî `–ì–æ—Ç–æ–≤–æ!`.  

---

## **10. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ üöÄ**  
1Ô∏è‚É£ –ù–∞–ø–∏—à–∏ **–≥–ª–æ–±–∞–ª—å–Ω—ã–π Middleware** –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.  
2Ô∏è‚É£ –°–æ–∑–¥–∞–π **–ª–æ–∫–∞–ª—å–Ω—ã–π Middleware** –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ `/admin`, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç `?admin=true`.  
3Ô∏è‚É£ –†–µ–∞–ª–∏–∑—É–π Middleware **–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization`**.  
4Ô∏è‚É£ –°–¥–µ–ª–∞–π **Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**.  
5Ô∏è‚É£ –î–æ–±–∞–≤—å **`express.json()`**, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–ª `POST`-–∑–∞–ø—Ä–æ—Å—ã —Å JSON.  
